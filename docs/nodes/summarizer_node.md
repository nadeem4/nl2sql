# SummarizerNode

## Purpose

The `SummarizerNode` operates within the "Reflexion" loop (Self-Correction). When the `ValidatorNode` or `ExecutorNode` reports errors, the control flow moves to the `SummarizerNode`. Its job is to analyze *why* the plan failed (using the error messages and the schema) and generate specific, constructive feedback (as a new error message) to guide the `PlannerNode` in its next attempt.

## Components

- **`LLM`**: To generate natural language advice for the Planner.
- **`SUMMARIZER_PROMPT`**: Instructions for diagnosing SQL/Plan errors.

## Inputs

The node reads the following fields from `GraphState`:

- `state.errors`: The list of errors generated by the Validator or Executor.
- `state.plan`: The failed plan.
- `state.schema_info`: The context of what tables/columns actually exist.
- `state.user_query`: The original intent.

## Outputs

The node updates the following fields in `GraphState`:

- `state.errors`: Replaces or appends to the error list with a consolidated "Feedback" error.
  - This feedback is consumed by the Planner in the next iteration.
- `state.reasoning`: Log entry showing the generated advice.

## Logic Flow

1. **Context Construction**:
    - Formats `schema_info` into a readable string.
    - Serializes the failed `plan`.
    - Extracts error messages.
2. **LLM Diagnosis**:
    - Asks the LLM: "Given this query, this plan, and these errors, what went wrong and how should the planner fix it?"
3. **Feedback generation**:
    - The LLM produces a text string (e.g., "Table 'orders' does not have column 'client_id', use 'customer_id' instead.").
4. **State Update**:
    - Wraps this feedback in a `PipelineError` with code `PLAN_FEEDBACK`.

## Error Handling

- **`SUMMARIZER_FAILED`**: If the LLM call fails.

## Dependencies

- `langchain_core.output_parsers.StrOutputParser`
