# yaml-language-server: $schema=./datasources.schema.json
version: 2

# Datasource Configuration Template (Production Ready)
# Supports Environment Variable expansion: ${env:VAR} or ${VAR}
# Secrets should NEVER be hardcoded here.

datasources:
  # ==========================================
  # 1. PostgreSQL (Production with SSL)
  # ==========================================
  # ==========================================
  # 1. PostgreSQL (Production with SSL)
  # ==========================================
  - id: postgres_prod_ssl
    description: "Primary analytics database with SSL enforcement"
    connection:
      type: postgres
      host: "db-prod.internal"
      port: 5432
      user: "app_user"
      password: "${env:POSTGRES_PASSWORD}"
      database: "analytics"
      options:
        sslmode: "verify-full"
        sslrootcert: "/etc/ssl/certs/rds-combined-ca-bundle.pem"
        connect_timeout: "10"
    options:
      # Pydantic/Validator options (not connection string)
      pool_size: 20
      max_overflow: 10
      pool_recycle: 3600

  # ==========================================
  # 2. Microsoft SQL Server (Windows Auth / Trusted)
  # ==========================================
  - id: mssql_integrated
    description: "Corporate Data Warehouse using Windows Authentication"
    connection:
      type: mssql
      host: "sqlserver-prod"
      port: 1433
      database: "Warehouse"
      driver: "ODBC Driver 17 for SQL Server"
      # 'trusted_connection' flag enables Windows Auth (Integrated Security)
      trusted_connection: true 
    feature_flags:
      allow_cross_db: true

  # ==========================================
  # 3. Microsoft SQL Server (Azure Active Directory)
  # ==========================================
  - id: azure_sql_aad
    description: "Azure SQL DB with Active Directory Password Auth"
    connection:
      type: mssql
      host: "my-server.database.windows.net"
      port: 1433
      user: "user@domain.com"
      password: "${env:AAD_PASSWORD}"
      database: "SalesDB"
      driver: "ODBC Driver 18 for SQL Server"
      options:
        Authentication: "ActiveDirectoryPassword"
        TrustServerCertificate: "no"
        Encrypt: "yes"

  # ==========================================
  # 4. MySQL (Standard with local socket)
  # ==========================================
  - id: mysql_socket
    description: "Legacy MySQL via Unix Socket"
    connection:
      type: mysql
      user: "root"
      password: "${env:MYSQL_ROOT_PASS}"
      database: "users"
      options:
         unix_socket: "/var/run/mysqld/mysqld.sock"

  # ==========================================
  # 5. SQLite (Local Development)
  # ==========================================
  - id: local_dev
    description: "Local file-based database"
    connection:
      type: sqlite
      database: "./data/local.db"
    feature_flags:
       # Enable dangerous writes only for local dev
       allow_generate_writes: true 

  # ==========================================
  # 6. Cloud Secret Providers (Optional)
  # ==========================================
  # Prerequisite: pip install nl2sql-core[aws|azure|hashicorp]
  
  # AWS Secrets Manager
  # password: "${aws:prod/db/password}"
  
  # Azure Key Vault (requires AZURE_KEYVAULT_URL)
  # password: "${azure:my-secret-name}"

  # HashiCorp Vault (requires VAULT_ADDR, VAULT_TOKEN)
  # password: "${hashi:secret/data/myapp:password}"
